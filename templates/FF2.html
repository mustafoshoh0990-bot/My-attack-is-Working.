<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Fire - –ü–∞–Ω–µ–ª—å –°–æ–∫—Ä–æ–≤–∏—â</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* –ò–≥—Ä–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ç–∏–ª–∏ */
        .game-page-bg {
            background-color: #0c4a6e;
            color: #f8fafc;
            background-image: url('https://frontalgamer.com/wp-content/uploads/2022/05/Conseguir-diamantes-gratis-Free-Fire.png');
            background-size: cover;
            background-position: center;
        }

        .card {
            background-color: rgba(13, 30, 48, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(49, 64, 86, 0.2);
        }

        .btn-primary {
            @apply bg-emerald-600 text-white hover:bg-emerald-700 focus:ring-emerald-500 w-full font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2;
        }

        .btn-green {
            @apply bg-green-600 text-white hover:bg-green-700 focus:ring-green-500 w-full font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2;
        }

        .btn-disabled {
            @apply bg-gray-500 text-gray-300 cursor-not-allowed w-full font-bold py-3 px-4 rounded-lg;
        }

        .coin-icon {
            display: inline-block;
            width: 1em;
            height: 1em;
            background: linear-gradient(135deg, #fef08a, #facc15);
            border-radius: 50%;
            vertical-align: middle;
            margin-right: 0.5rem;
            box-shadow: 0 0 8px #facc15;
        }

        .diamond-icon {
            display: inline-block;
            width: 1em;
            height: 1em;
            background: linear-gradient(135deg, #a78bfa, #8b5cf6);
            clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
            vertical-align: middle;
            margin-right: 0.5rem;
            box-shadow: 0 0 8px #8b5cf6;
        }

        .gift-icon {
            display: inline-block;
            width: 1em;
            height: 1em;
            background: linear-gradient(135deg, #fef08a, #f87171);
            clip-path: polygon(0% 25%, 50% 0%, 100% 25%, 100% 100%, 0% 100%);
            vertical-align: middle;
            margin-right: 0.5rem;
        }

        .modal {
            @apply fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900 bg-opacity-75 backdrop-filter backdrop-blur-sm;
        }

        .modal-content {
            @apply bg-slate-800 p-8 rounded-2xl shadow-2xl max-w-sm w-full text-center;
        }

        .input-field {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background-color: #374151;
            color: #ffffff;
            border: 1px solid #4b5563;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        .input-field:focus {
            outline: none;
            border-color: #10b981;
        }

        .input-field::placeholder {
            color: #9ca3af;
        }
    </style>
</head>
<body class="game-page-bg min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md mx-auto">
        <div class="mb-4 text-center">
            <img id="game-image" src="https://avatars.mds.yandex.net/i?id=ee9a4faba7d57306afe96f5e0d3bb7f7b27dd979-4257546-images-thumbs&n=13" alt="Game Image" class="w-full max-w-xs mx-auto rounded-lg shadow-lg">
        </div>

        <div id="rewards-view" class="active">
            <div class="card p-8 rounded-2xl shadow-xl text-center">
                <h1 class="text-3xl font-extrabold mb-2">–ü–∞–Ω–µ–ª—å –°–æ–∫—Ä–æ–≤–∏—â</h1>
                <p class="text-slate-400 mb-2">–ò–≥—Ä–æ–∫: {{ user.uid }}</p>
                <p class="text-slate-400 mb-6">–°–æ–±–∏—Ä–∞–π—Ç–µ –º–æ–Ω–µ—Ç—ã –∏ –æ–±–º–µ–Ω–∏–≤–∞–π—Ç–µ –∏—Ö –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∞–ª–º–∞–∑—ã!</p>

                <div class="grid grid-cols-2 gap-4 bg-slate-800 p-6 rounded-xl my-4">
                    <div class="flex flex-col items-center">
                        <p class="text-slate-400 font-medium">–í–∞—à–∏ –ú–æ–Ω–µ—Ç—ã</p>
                        <div class="flex items-center text-4xl font-extrabold my-2 text-white">
                            <span class="coin-icon"></span>
                            <span id="coins-counter">{{ user.coins }}</span>
                        </div>
                    </div>
                    <div class="flex flex-col items-center">
                        <p class="text-slate-400 font-medium">–í–∞—à–∏ –ê–ª–º–∞–∑—ã</p>
                        <div class="flex items-center text-4xl font-extrabold text-violet-500">
                            <span class="diamond-icon"></span>
                            <span id="diamonds-counter">{{ user.diamonds }}</span>
                        </div>
                    </div>
                </div>

                <div class="my-6 space-y-4">
                    <button id="exchange-button" class="btn-primary">–û–±–º–µ–Ω—è—Ç—å –Ω–∞ 35 –ê–ª–º–∞–∑–æ–≤ (500 –º–æ–Ω–µ—Ç)</button>
                    <button id="gift-button" class="btn-green">
                        <span class="gift-icon"></span>
                        –ü–æ–ª—É—á–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫
                    </button>
                    <button id="gemini-button" class="w-full font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-gray-700 text-white hover:bg-gray-800 focus:ring-gray-600">
                        –ü–æ–ª—É—á–∏—Ç—å ‚ú® —Å–æ–≤–µ—Ç –æ—Ç –ò–ò !
                    </button>
                </div>
                <div id="status-message" class="mt-4 font-bold h-6 text-sm"></div>
            </div>
            <button id="withdraw-button" class="btn-primary mt-4">–í—ã–≤–æ–¥</button>

            <div class="mt-4 text-center">
                <a href="/" class="text-blue-400 hover:text-blue-300 underline">
                    ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≥–ª–∞–≤–Ω–æ–π
                </a>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –¥–ª—è –∏–≥—Ä—ã -->
    <div id="withdraw-modal" class="modal hidden">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">–í—ã–≤–æ–¥ –ê–ª–º–∞–∑–æ–≤</h2>
            <p class="text-slate-400 mb-6">–í–≤–µ–¥–∏—Ç–µ UID –∏–≥—Ä–æ–∫–∞, —á—Ç–æ–±—ã –≤—ã–≤–µ—Å—Ç–∏ –∞–ª–º–∞–∑—ã.</p>
            <input id="uid-input" type="text" placeholder="UID –∏–≥—Ä–æ–∫–∞" class="input-field mb-4" value="{{ user.uid }}">
            <button id="submit-withdraw" class="btn-green">–í—ã–≤–µ—Å—Ç–∏ 100 –ê–ª–º–∞–∑–æ–≤</button>
        </div>
    </div>

    <div id="gemini-modal" class="modal hidden">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">–°–æ–≤–µ—Ç –æ—Ç –ò–ò</h2>
            <p id="gemini-text" class="text-slate-400 mb-6"></p>
            <button id="close-gemini-modal" class="btn-green">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        const USER_UID = "{{ user.uid }}";
        let coins = parseInt("{{ user.coins }}") || 0;
        let diamonds = parseInt("{{ user.diamonds }}") || 0;

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const coinsCounter = document.getElementById('coins-counter');
        const diamondsCounter = document.getElementById('diamonds-counter');
        const exchangeButton = document.getElementById('exchange-button');
        const giftButton = document.getElementById('gift-button');
        const withdrawButton = document.getElementById('withdraw-button');
        const withdrawModal = document.getElementById('withdraw-modal');
        const submitWithdrawButton = document.getElementById('submit-withdraw');
        const uidInput = document.getElementById('uid-input');
        const statusMessage = document.getElementById('status-message');
        const geminiButton = document.getElementById('gemini-button');
        const geminiModal = document.getElementById('gemini-modal');
        const geminiText = document.getElementById('gemini-text');
        const closeGeminiModal = document.getElementById('close-gemini-modal');

        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–≥—Ä—ã
        const EXCHANGE_COST = 500;
        const EXCHANGE_REWARD = 35;
        const WITHDRAWAL_REWARD = 100;

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let intervalId = null;
        let isExchanging = false;
        let lastGiftDate = localStorage.getItem('lastGiftDate_' + USER_UID);

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
        function updateCounters() {
            coinsCounter.textContent = coins;
            diamondsCounter.textContent = diamonds;
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        async function saveProgress() {
            try {
                const response = await fetch('/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        uid: USER_UID,
                        coins: coins,
                        diamonds: diamonds
                    })
                });

                const result = await response.json();
                if (!result.success) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', result.error);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:', error);
            }
        }

        // –ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–æ–Ω–µ—Ç
        function startCoinGeneration() {
            if (intervalId) clearInterval(intervalId);

            intervalId = setInterval(() => {
                coins += 1;
                updateCounters();
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
                if (coins % 10 === 0) {
                    saveProgress();
                }
            }, 1000);
        }

        // –û–±–º–µ–Ω –º–æ–Ω–µ—Ç –Ω–∞ –∞–ª–º–∞–∑—ã
        exchangeButton.addEventListener('click', async () => {
            if (isExchanging) {
                statusMessage.textContent = '–û–±–º–µ–Ω —É–∂–µ –∏–¥—ë—Ç...';
                return;
            }

            statusMessage.classList.remove('text-green-500', 'text-red-500', 'text-blue-500');

            if (coins >= EXCHANGE_COST) {
                isExchanging = true;
                exchangeButton.disabled = true;
                statusMessage.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–º–µ–Ω–∞...';
                statusMessage.classList.add('text-blue-500');

                setTimeout(async () => {
                    coins -= EXCHANGE_COST;
                    diamonds += EXCHANGE_REWARD;
                    updateCounters();
                    await saveProgress();
                    statusMessage.textContent = '–û–±–º–µ–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω ‚úÖ';
                    statusMessage.classList.replace('text-blue-500', 'text-green-500');
                    isExchanging = false;
                    exchangeButton.disabled = false;
                }, 3000);
            } else {
                statusMessage.textContent = `–ù—É–∂–Ω–æ –µ—â—ë ${EXCHANGE_COST - coins} –º–æ–Ω–µ—Ç –¥–ª—è –æ–±–º–µ–Ω–∞`;
                statusMessage.classList.add('text-red-500');
            }
        });

        // –í—ã–≤–æ–¥ –∞–ª–º–∞–∑–æ–≤
        withdrawButton.addEventListener('click', () => {
            withdrawModal.classList.remove('hidden');
            statusMessage.textContent = '';
        });

        submitWithdrawButton.addEventListener('click', async () => {
            const uid = uidInput.value.trim();

            if (uid === '') {
                statusMessage.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ UID.';
                statusMessage.classList.add('text-red-500');
                return;
            }

            if (diamonds < WITHDRAWAL_REWARD) {
                withdrawModal.classList.add('hidden');
                statusMessage.textContent = `–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ê–ª–º–∞–∑–æ–≤. –ù—É–∂–Ω–æ ${WITHDRAWAL_REWARD} –¥–ª—è –≤—ã–≤–æ–¥–∞.`;
                statusMessage.classList.add('text-red-500');
                return;
            }

            withdrawModal.classList.add('hidden');
            statusMessage.classList.remove('text-green-500', 'text-red-500', 'text-blue-500');
            statusMessage.textContent = '–ò–¥—ë—Ç –≤—ã–≤–æ–¥...';
            statusMessage.classList.add('text-blue-500');

            setTimeout(async () => {
                diamonds -= WITHDRAWAL_REWARD;
                updateCounters();
                await saveProgress();
                statusMessage.textContent = `–í—ã–≤–µ–¥–µ–Ω–æ ${WITHDRAWAL_REWARD} –ê–ª–º–∞–∑–æ–≤ –Ω–∞ UID ${uid} ‚úÖ`;
                statusMessage.classList.replace('text-blue-500', 'text-green-500');
            }, 5000);
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        window.addEventListener('click', (event) => {
            if (event.target === withdrawModal) {
                withdrawModal.classList.add('hidden');
            }
            if (event.target === geminiModal) {
                geminiModal.classList.add('hidden');
            }
        });

        // –°–æ–≤–µ—Ç—ã –æ—Ç –ò–ò
        async function getGeminiResponse() {
            const tips = [
                '–ü—Ä–∏–≤–µ—Ç, –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫! –ß—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ —Ä–∞–∑–±–æ–≥–∞—Ç–µ—Ç—å, –æ–±–º–µ–Ω–∏–≤–∞–π –º–æ–Ω–µ—Ç—ã –Ω–∞ –∞–ª–º–∞–∑—ã —Å—Ä–∞–∑—É, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –Ω–∞–∫–æ–ø–∏—à—å 500!',
                '–ù–µ –∑–∞–±—ã–≤–∞–π –ø–æ–ª—É—á–∞—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫ ‚Äî —ç—Ç–æ 100 –º–æ–Ω–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω–æ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å!',
                '–¢–µ—Ä–ø–µ–Ω–∏–µ ‚Äî –∫–ª—é—á –∫ —É—Å–ø–µ—Ö—É! –ú–æ–Ω–µ—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É.',
                '–°–æ–≤–µ—Ç –æ—Ç –º–∞—Å—Ç–µ—Ä–∞: –∫–æ–ø–∏ –∞–ª–º–∞–∑—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø–æ–∫—É–ø–æ–∫ –≤ Free Fire!',
                '–ü–æ–º–Ω–∏: —á–µ–º –¥–æ–ª—å—à–µ —Ç—ã –æ—Å—Ç–∞—ë—à—å—Å—è –≤ –∏–≥—Ä–µ, —Ç–µ–º –±–æ–ª—å—à–µ –º–æ–Ω–µ—Ç –ø–æ–ª—É—á–∞–µ—à—å!',
                '–¢–≤–æ–π UID: ' + USER_UID + ' - –Ω–µ –∑–∞–±—É–¥—å –µ–≥–æ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ –∞–ª–º–∞–∑–æ–≤!',
                '–û—Å—Ç–∞–≤–ª—è–π —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ—Ç–∫—Ä—ã—Ç–æ–π, —á—Ç–æ–±—ã –º–æ–Ω–µ—Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∞–ª–∏ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å—Å—è!'
            ];

            return tips[Math.floor(Math.random() * tips.length)];
        }

        geminiButton.addEventListener('click', async () => {
            geminiText.textContent = 'NPC –¥—É–º–∞–µ—Ç...';
            geminiModal.classList.remove('hidden');

            setTimeout(async () => {
                const advice = await getGeminiResponse();
                geminiText.textContent = advice;
            }, 1500);
        });

        closeGeminiModal.addEventListener('click', () => {
            geminiModal.classList.add('hidden');
        });

        // –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫
        function checkGiftStatus() {
            const today = new Date().toDateString();

            if (lastGiftDate === today) {
                giftButton.textContent = '–ü–æ–¥–∞—Ä–æ–∫ —É–∂–µ –ø–æ–ª—É—á–µ–Ω —Å–µ–≥–æ–¥–Ω—è';
                giftButton.classList.replace('btn-green', 'btn-disabled');
                giftButton.disabled = true;
            } else {
                giftButton.innerHTML = '<span class="gift-icon"></span>–ü–æ–ª—É—á–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫';
                giftButton.classList.replace('btn-disabled', 'btn-green');
                giftButton.disabled = false;
            }
        }

        giftButton.addEventListener('click', async () => {
            const today = new Date().toDateString();
            lastGiftDate = today;
            localStorage.setItem('lastGiftDate_' + USER_UID, today);
            coins += 100;
            updateCounters();
            await saveProgress();
            statusMessage.textContent = '–ü–æ–ª—É—á–µ–Ω–æ 100 –º–æ–Ω–µ—Ç! ‚úÖ';
            statusMessage.classList.add('text-green-500');
            checkGiftStatus();
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initializeGame() {
            checkGiftStatus();
            startCoinGeneration();
            updateCounters();

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(saveProgress, 30000);
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', () => {
            saveProgress();
        });

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        window.addEventListener('DOMContentLoaded', initializeGame);

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∏–≥—Ä–æ–≤–æ–≥–æ –æ–ø—ã—Ç–∞

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –º–æ–Ω–µ—Ç
        function animateCoinGain(amount = 1) {
            const coinElement = document.getElementById('coins-counter');
            coinElement.style.transform = 'scale(1.2)';
            coinElement.style.color = '#facc15';

            setTimeout(() => {
                coinElement.style.transform = 'scale(1)';
                coinElement.style.color = '#ffffff';
            }, 200);
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∞–ª–º–∞–∑–æ–≤
        function animateDiamondGain() {
            const diamondElement = document.getElementById('diamonds-counter');
            diamondElement.style.transform = 'scale(1.3)';
            diamondElement.style.color = '#a78bfa';

            setTimeout(() => {
                diamondElement.style.transform = 'scale(1)';
                diamondElement.style.color = '#8b5cf6';
            }, 300);
        }

        // –£–ª—É—á—à–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–Ω–µ—Ç —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
        function startCoinGenerationWithAnimation() {
            if (intervalId) clearInterval(intervalId);

            intervalId = setInterval(() => {
                coins += 1;
                updateCounters();
                animateCoinGain();

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
                if (coins % 10 === 0) {
                    saveProgress();
                }
            }, 1000);
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        function initializeGameWithAnimations() {
            checkGiftStatus();
            startCoinGenerationWithAnimation();
            updateCounters();

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(saveProgress, 30000);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            setTimeout(() => {
                statusMessage.textContent = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –∏–≥—Ä–æ–∫ ${USER_UID}! –ú–æ–Ω–µ—Ç—ã –Ω–∞—á–∞–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è! üéÆ`;
                statusMessage.classList.add('text-green-500');
            }, 1000);
        }

        // –£–ª—É—á—à–µ–Ω–Ω—ã–π –æ–±–º–µ–Ω —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
        exchangeButton.addEventListener('click', async () => {
            if (isExchanging) {
                statusMessage.textContent = '–û–±–º–µ–Ω —É–∂–µ –∏–¥—ë—Ç...';
                return;
            }

            statusMessage.classList.remove('text-green-500', 'text-red-500', 'text-blue-500');

            if (coins >= EXCHANGE_COST) {
                isExchanging = true;
                exchangeButton.disabled = true;
                exchangeButton.textContent = '–û–±–º–µ–Ω–∏–≤–∞–µ–º...';
                statusMessage.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–º–µ–Ω–∞...';
                statusMessage.classList.add('text-blue-500');

                setTimeout(async () => {
                    coins -= EXCHANGE_COST;
                    diamonds += EXCHANGE_REWARD;
                    updateCounters();
                    animateDiamondGain();
                    await saveProgress();
                    statusMessage.textContent = `–û–±–º–µ–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω! –ü–æ–ª—É—á–µ–Ω–æ ${EXCHANGE_REWARD} –∞–ª–º–∞–∑–æ–≤ ‚úÖ`;
                    statusMessage.classList.replace('text-blue-500', 'text-green-500');
                    isExchanging = false;
                    exchangeButton.disabled = false;
                    exchangeButton.textContent = '–û–±–º–µ–Ω—è—Ç—å –Ω–∞ 35 –ê–ª–º–∞–∑–æ–≤ (500 –º–æ–Ω–µ—Ç)';
                }, 3000);
            } else {
                const needed = EXCHANGE_COST - coins;
                statusMessage.textContent = `–ù—É–∂–Ω–æ –µ—â—ë ${needed} –º–æ–Ω–µ—Ç –¥–ª—è –æ–±–º–µ–Ω–∞ (–æ—Å—Ç–∞–ª–æ—Å—å ${Math.ceil(needed)} —Å–µ–∫—É–Ω–¥)`;
                statusMessage.classList.add('text-red-500');
            }
        });

        // –ö–ª–∏–∫ –ø–æ –º–æ–Ω–µ—Ç–∞–º –¥–ª—è –±–æ–Ω—É—Å–∞
        coinsCounter.addEventListener('click', () => {
            coins += 5;
            updateCounters();
            animateCoinGain(5);
            statusMessage.textContent = '–ë–æ–Ω—É—Å! +5 –º–æ–Ω–µ—Ç –∑–∞ –∫–ª–∏–∫! üéØ';
            statusMessage.classList.add('text-green-500');
            setTimeout(() => {
                statusMessage.textContent = '';
            }, 2000);
        });

        // –ö–ª–∏–∫ –ø–æ –∞–ª–º–∞–∑–∞–º –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        diamondsCounter.addEventListener('click', () => {
            statusMessage.textContent = `–£ –≤–∞—Å ${diamonds} –∞–ª–º–∞–∑–æ–≤. –ù—É–∂–Ω–æ ${WITHDRAWAL_REWARD} –¥–ª—è –≤—ã–≤–æ–¥–∞! üíé`;
            statusMessage.classList.add('text-blue-500');
            setTimeout(() => {
                statusMessage.textContent = '';
            }, 3000);
        });

        // –ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (–±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–≤—É–∫–æ–≤, –Ω–æ —Å –≤–∏–∑—É–∞–ª—å–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑—å—é)
        function playClickEffect(element) {
            element.style.boxShadow = '0 0 20px rgba(59, 130, 246, 0.8)';
            setTimeout(() => {
                element.style.boxShadow = '';
            }, 200);
        }

        // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
        document.querySelectorAll('button').forEach(button => {
            button.addEventListener('click', () => {
                playClickEffect(button);
            });
        });

        // –°—á–µ—Ç—á–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ –≤ –∏–≥—Ä–µ
        let gameStartTime = Date.now();
        let timeInGame = 0;

        function updateGameTime() {
            timeInGame = Math.floor((Date.now() - gameStartTime) / 1000);
            const minutes = Math.floor(timeInGame / 60);
            const seconds = timeInGame % 60;

            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            console.log(`–í—Ä–µ–º—è –≤ –∏–≥—Ä–µ: ${minutes}:${seconds.toString().padStart(2, '0')}`);
        }

        setInterval(updateGameTime, 1000);

        // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
        const achievements = {
            firstExchange: false,
            hundred_coins: false,
            thousand_coins: false,
            first_diamond: false,
            first_withdrawal: false
        };

        function checkAchievements() {
            if (coins >= 100 && !achievements.hundred_coins) {
                achievements.hundred_coins = true;
                showAchievement('–ü–µ—Ä–≤–∞—è —Å–æ—Ç–Ω—è! üèÜ', '–í—ã –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏ 100 –º–æ–Ω–µ—Ç!');
            }

            if (coins >= 1000 && !achievements.thousand_coins) {
                achievements.thousand_coins = true;
                showAchievement('–ú–∞–≥–Ω–∞—Ç! üí∞', '–£ –≤–∞—Å 1000+ –º–æ–Ω–µ—Ç!');
            }

            if (diamonds >= 1 && !achievements.first_diamond) {
                achievements.first_diamond = true;
                showAchievement('–ü–µ—Ä–≤—ã–π –∞–ª–º–∞–∑! üíé', '–í—ã –ø–æ–ª—É—á–∏–ª–∏ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∞–ª–º–∞–∑!');
            }
        }

        function showAchievement(title, description) {
            const achievementDiv = document.createElement('div');
            achievementDiv.className = 'fixed top-4 right-4 bg-yellow-600 text-white p-4 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-500';
            achievementDiv.innerHTML = `
                <div class="font-bold">${title}</div>
                <div class="text-sm">${description}</div>
            `;

            document.body.appendChild(achievementDiv);

            setTimeout(() => {
                achievementDiv.style.transform = 'translateX(0)';
            }, 100);

            setTimeout(() => {
                achievementDiv.style.transform = 'translateX(full)';
                setTimeout(() => {
                    document.body.removeChild(achievementDiv);
                }, 500);
            }, 3000);
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        const originalUpdateCounters = updateCounters;
        updateCounters = function() {
            originalUpdateCounters();
            checkAchievements();
        };

        // –ó–∞–º–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
        window.removeEventListener('DOMContentLoaded', initializeGame);
        window.addEventListener('DOMContentLoaded', initializeGameWithAnimations);

        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
        window.addEventListener('blur', saveProgress);

        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
        setInterval(() => {
            if (coins > 0 || diamonds > 0) {
                saveProgress();
            }
        }, 15000); // –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥

        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-600' : type === 'error' ? 'bg-red-600' : 'bg-blue-600';

            notification.className = `fixed top-4 left-1/2 transform -translate-x-1/2 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 opacity-0 transition-opacity duration-300`;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '1';
            }, 100);

            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
        const originalSaveProgress = saveProgress;
        saveProgress = async function() {
            try {
                await originalSaveProgress();
                // –¢–∏—Ö–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è —á–∞—Å—Ç—ã—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞!', 'error');
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
            }
        };

        console.log('üéÆ –ò–≥—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–∞! –£–¥–∞—á–∏ –≤ —Å–±–æ—Ä–µ –∞–ª–º–∞–∑–æ–≤!');
    </script>
</body>
</html>